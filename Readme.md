# GitHub Action: Auto Create Pull Requests with OpenAI-generated Information

This GitHub Action automatically creates a Pull Request (PR) when a new push is made to a branch if no open PR exists. It uses the OpenAI API to generate a title and description for the PR based on the latest commit message and commit history. If a PR already exists for the branch, a comment will be added with additional information generated by OpenAI.

## Features
- Automatically checks for existing open PRs.
- Generates PR title and description using OpenAI's GPT-3 model.
- Verifies commit messages using `commitlint`.
- Adds comments to existing PRs if applicable.
- GitHub API integration for PR management.

## Prerequisites

1. **GitHub Repository**: You must have a GitHub repository where you want to use this action.
2. **GitHub Secrets**: Store sensitive information as GitHub secrets:
   - `OPENAI_API_KEY`: Your OpenAI API key for generating the PR details.
   - `GITHUB_TOKEN`: GitHub token for authenticating API requests (usually provided automatically by GitHub Actions).

## Setup

1. **Clone the repository**:
   ```bash
   git clone https://github.com/Sinless777/PR-Creator.git
   ```

2. **Install dependencies**:
   This action relies on Python and `npx` for `commitlint`. You can install the dependencies by running:
   ```bash
   pip install -r requirements.txt
   ```

3. **Add GitHub Secrets**:
   - Go to your repository's **Settings** > **Secrets and variables** > **Actions**.
   - Click **New repository secret** and add the following secrets:
     - `OPENAI_API_KEY`: Your OpenAI API key.
     - `GITHUB_TOKEN`: GitHub token (usually auto-set by GitHub Actions).

## Usage

1. **GitHub Actions Workflow**:
   Add the following workflow YAML file to `.github/workflows/auto-create-pr.yml`:

   ```yaml
   name: Auto Create PR

   on:
     push:
       branches:
         - main
         - '**'  # Adjust as needed

   jobs:
     create-pr:
       runs-on: ubuntu-latest

       steps:
       - name: Checkout repository
         uses: actions/checkout@v2

       - name: Set up Python
         uses: actions/setup-python@v2
         with:
           python-version: '3.x'  # Specify the Python version

       - name: Install dependencies
         run: |
           python -m pip install --upgrade pip
           pip install openai requests

       - name: Run PR creation script
         env:
           OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
           GITHUB_REPOSITORY_OWNER: ${{ github.repository_owner }}
           GITHUB_REPOSITORY: ${{ github.event.repository.name }}
           GITHUB_REPOSITORY_BRANCH: ${{ github.ref_name }}
           GITHUB_REPOSITORY_HEAD: ${{ github.sha }}
         run: |
           python ./src/main.py
   ```

2. **Run the Action**:
   The action will run automatically when a new push occurs on the branches specified in the workflow file.

## Environment Variables

The following environment variables are required by the Python script and are passed via the GitHub Action workflow:

- **OPENAI_API_KEY**: The API key for OpenAI to generate PR titles, descriptions, and comments.
- **GITHUB_TOKEN**: The GitHub token for authenticating API requests.
- **GITHUB_REPOSITORY_OWNER**: The owner of the repository (GitHub automatically provides this).
- **GITHUB_REPOSITORY**: The repository name (GitHub automatically provides this).
- **GITHUB_REPOSITORY_BRANCH**: The branch where the commit was made.
- **GITHUB_REPOSITORY_HEAD**: The commit SHA of the head.

## Scripts Overview

### `./src/main.py`

This script:
- Checks for existing PRs on the current branch.
- If a PR doesn't exist, it generates a PR title and description using OpenAI and creates a PR.
- If a PR exists, it adds a comment to the PR with additional context generated by OpenAI.

#### Functions:
- `get_latest_commit_message()`: Fetches the latest commit message.
- `check_for_existing_pr()`: Checks GitHub API for an open PR on the current branch.
- `verify_commit_message()`: Uses `commitlint` to validate the commit message format.
- `get_commit_history()`: Fetches the last 10 commit messages.
- `generate_pr_title()`: Generates a PR title using OpenAI's GPT-3 model.
- `generate_pr_description()`: Generates a PR description based on the commit message, history, and title.
- `create_pr()`: Creates a new PR via the GitHub API.
- `add_comment_to_pr()`: Adds a comment to an existing PR.

## Dependencies

- **Python**: Used for handling GitHub API interactions and OpenAI requests.
- **OpenAI Python Library**: Used to interact with the OpenAI API to generate text.
- **requests**: Used to interact with the GitHub API.
- **commitlint**: Used to enforce commit message standards (installed via `npx`).

## Security

- **GitHub Secrets**: Use GitHub Secrets to store your sensitive API keys (e.g., OpenAI API Key) to avoid committing them directly to the repository.
  
## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

---

This `README.md` provides clear instructions for setting up and using your GitHub Action. You can modify it to suit your specific requirements or project goals.